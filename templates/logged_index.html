{% extends "template.html" %}
{% load extras %}

{% block content %}
    <div class="row">
        <div class="col-sm-4 col-xs-12">
            <div class="panel panel-default">
                <div class="panel panel-body">
                    <div class="col-sm-12 col-xs-4">
                        <div class="thumbnail">
                            {{ user|userAvatar }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-xs-8">
                        <h3>{{ user.first_name }} {{ user.last_name }}</h3>

                        {%  if user.bio %}
                            <blockquote>
                                <em>{{ user.bio }}</em>
                            </blockquote>
                        {% endif %}

                        <hr>

                        {% if place %}
                            <div class="col-sm-12 user-info">
                                <span class="mdi-social-domain"></span>&nbsp;{{ place }}
                            </div>
                        {% endif %}

                        {% if birthdate %}
                            <div class="col-sm-12 user-info">
                                <span class="mdi-social-cake"></span>&nbsp;{{ user.birthdate|date:"M d, Y" }}
                            </div>
                        {% endif %}
                    </div>
                    <div id="" class="col-sm-10 col-xs-10 btn-update">
                        <button type="submit" class="btn btn-info" onclick="updateRedirection()">Update</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-8 col-xs-12">
            <div class="panel panel-default">
                <div class="panel panel-body">
                    <div class="count"></div>
                    <form id="gab-form" action="{% url "post_gab" %}" method="post">
                        {% csrf_token %}
                        <div contentEditable="true" class="content-field" name="gab-div">
                        </div>
                        <input type="hidden" name="text" id="content">
                        <div class="text-right">
                            <button id="send-gab" class="btn btn-success" type="submit" disabled="true">Send</button>
                        </div>
                    </form>
                </div>
            </div>
            {% include "skeletons/gab.html" with gabs=gabs %}

            <div class="panel panel-default">
                <div class="panel-body">
                    Your profile : {{ user|userlink }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block additional_scripts %}
    <script type="text/javascript">
    $(document).ready(function() {
        manageBlock("#gab-form", ".content-field", "#content", "#send-gab", 255);

        $(".delete-gab").on("click", confirmDeletion);
        $(".report-gab").on("click", function (evt) {
           var url = $(this).attr("href");
           evt.preventDefault();
           swal({
                title: "Report this gab.",
                text: "Why do you find that this gab must be reported?",
                type: "input",
                showCancelButton: true,
                closeOnConfirm: false,
                inputPlaceHolder: "Write a reason"
           }, function (reason) {
             if (reason === false) return false;

             if (reason === "") {
               swal.showInputError("You need to write a reason.");
               return false
             }
             $.getJSON(url, {reason: reason}, function (resp) {
               if (resp.success) {
                   swal("Thanks!", "You reported this gab. Our moderation team will review your report as soon as possible.", "success");
               }
             });
           });
        });
    });
    </script>
{% endblock %}
